<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebRTC with PeerJS - Two Rooms</title>
  <style>
    body { text-align: center; font-family: sans-serif; }
    video { width: 45%; margin: 1%; border: 2px solid black; }
  </style>
</head>
<body>
  <h1>PeerJS WebRTC - Multi-Room</h1>

  <label>Select Room:</label>
  <select id="room">
    <option value="room1">Room 1</option>
    <option value="room2">Room 2</option>
  </select><br><br>

  <button onclick="init()">Join Room</button><br><br>

  <p>Your ID: <input id="my-id" readonly></p>
  <input id="target-id" placeholder="Enter Peer ID to Call">
  <button onclick="startCall()">Call Peer</button>

  <div>
    <video id="localVideo" autoplay muted playsinline></video>
    <video id="remoteVideo" autoplay playsinline></video>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <script>
    let peer, localStream;
    const roomPeers = { room1: [], room2: [] };
    const myIdInput = document.getElementById('my-id');
    const targetIdInput = document.getElementById('target-id');
    const roomSelect = document.getElementById('room');
    const localVideo = document.getElementById('localVideo');
    const remoteVideo = document.getElementById('remoteVideo');

    async function init() {
      const room = roomSelect.value;

      localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
      localVideo.srcObject = localStream;

      peer = new Peer(undefined, {
        host: 'peerjs.com',
        port: 443,
        secure: true
      });

      peer.on('open', id => {
        myIdInput.value = id;
        roomPeers[room].push(id);
      });

      peer.on('call', call => {
        call.answer(localStream);
        call.on('stream', stream => {
          remoteVideo.srcObject = stream;
        });
      });
    }

    function startCall() {
      const targetId = targetIdInput.value;
      const call = peer.call(targetId, localStream);
      call.on('stream', stream => {
        remoteVideo.srcObject = stream;
      });
    }
  </script>
</body>
</html>
