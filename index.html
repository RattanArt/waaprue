
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selfie Segmentation</title>
    <style>
        #output {
            position: absolute;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
			background-color: #f0f0f0;
        }

        #video {
			display: flex;
        }
		#output {
		display: flex;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: #fff;
        }
    </style>
</head>
<body>
    <div>
        <!---->
		<video id="video" width="40" height="30" autoplay playsinline></video>
		
        <canvas id="output" width="640" height="480"></canvas>
    </div>
    
    <script type="module">
	
const videoElement = document.getElementById('video');
const canvasElement = document.getElementById('output');
const loadingText = document.createElement('p');
loadingText.textContent = 'Loading...';
document.body.appendChild(loadingText);

async function loadMediaPipe() {
  const backgroundImage = new Image();
  backgroundImage.src = 'https://raw.githubusercontent.com/RattanArt/Model/refs/heads/main/imgHeat03.png';
  backgroundImage.crossOrigin = "anonymous";
  await new Promise(resolve => backgroundImage.onload = resolve);

  await new Promise(resolve => {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation';
    script.type = 'module';
    script.onload = resolve;
    document.head.appendChild(script);
  });
}


async function main() {
    await loadMediaPipe();
    await new Promise(resolve => {
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js';
      script.type = 'module';
      script.onload = resolve;
      document.head.appendChild(script);
    });
  
    await new Promise(resolve => {
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js';
      script.type = 'module';
      script.onload = resolve;
      document.head.appendChild(script);
    });

  const canvasCtx = canvasElement.getContext('2d');
  
  const backgroundImage = new Image();
  backgroundImage.src = 'https://raw.githubusercontent.com/RattanArt/Model/refs/heads/main/imgHeat03.png';
  backgroundImage.crossOrigin = "anonymous";
  await new Promise(resolve => backgroundImage.onload = resolve);

  const selfieSegmentation = new SelfieSegmentation({locateFile: (file) => {
    return `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`;
  }});

  selfieSegmentation.setOptions({
    modelSelection: 1,
  });

  selfieSegmentation.onResults((results) => {
    canvasCtx.save();
    canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
    canvasCtx.drawImage(results.segmentationMask, 0, 0, canvasElement.width, canvasElement.height);

    canvasCtx.globalCompositeOperation = 'source-in';
    canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

      canvasCtx.globalCompositeOperation = 'destination-over';
      canvasCtx.drawImage(backgroundImage, 0, 0, canvasElement.width, canvasElement.height);
  

    canvasCtx.restore();
  });

  const camera = new Camera(videoElement, {
    onFrame: async () => {
      await selfieSegmentation.send({image: videoElement});
    },
    width: 640,
    height: 480,
  });
  camera.start();
  loadingText.remove();
}

navigator.mediaDevices.getUserMedia({ video: true }).then(() => {
  main();
}).catch((error) => {
    console.error("Error accessing camera:", error);
    loadingText.textContent = "Error accessing camera. Please check permissions.";
  });
	
	</script>
</body>
</html>
